# Gradle

## Gradleì´ë€?

- Gradleì€ goovyë¥¼ ê¸°ë°˜(ì½”í‹€ë¦°ë„ ì‚¬ìš©ê°€ëŠ¥)ìœ¼ë¡œ í•œ **ë¹Œë“œë„êµ¬**ì´ë©° **Antì™€ Maven**ì˜ ë‹¨ì ì„ ë³´ì™„í•˜ê³  ì¥ì ì„ ì·¨í•©í•˜ì—¬ ë§Œë“  ì˜¤í”ˆì†ŒìŠ¤ë¡œ ê³µê°œëœ ë¹Œë“œ ë„êµ¬
- XML ì–¸ì–´ê°€ ì•„ë‹Œ ìë°” ë¬¸ë²•ê³¼ ìœ ì‚¬í•œ Groovyë¥¼ ì‚¬ìš©, ìµœê·¼ì—” kotlinë„ ì‚¬ìš©í•˜ëŠ” ì¶”ì„¸
- Gradle Wrapperë¥¼ ì‚¬ìš©í•´ì„œ ì„¤ì¹˜ì—†ì´ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.
- DSL(Domain Specific Language) í™œìš©í•˜ì—¬ ê¹”ë”í•œ ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤. ([https://docs.gradle.org/current/dsl/](https://docs.gradle.org/current/dsl/))

## Gradle vs Maven

- [https://gradle.org/maven-vs-gradle/](https://gradle.org/maven-vs-gradle/)

### Maven ë‹¨ì 

- Gradleì— ë¹„í•´ ìƒëŒ€ì ìœ¼ë¡œ ëŸ¬ë‹ì»¤ë¸Œê°€ ë†’ë‹¤. (ê°œì¸ì°¨ìˆìŒ)
- í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ ì»¤ì§€ë©´ xmlì½”ë“œê°€ ë³µì¡í•´ì ¸ì„œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ê°€ ì–´ë µê³  ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤.
    - ë©€í‹° í”„ë¡œì íŠ¸ ì¼ë•Œë„ ì—¬ëŸ¬ í”„ë¡œì íŠ¸ì˜ pom.xmlì„ ë”°ë¡œ ê´€ë¦¬í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë²ˆê±°ë¡­ë‹¤.

### Gradle ì¥ì 

- Build Cache, Gradle Daemonì„ ì‚¬ìš©í•´ì„œ ë©”ì´ë¸ë³´ë‹¤ ì„±ëŠ¥ì´ ì›”ë“±íˆ ìš°ìˆ˜í•˜ë‹¤. (ê³µí™ˆ ì°¸ê³ )
- **Gradle Wrapper ì œê³µ**ì„ í†µí•´ ì‘ì—…ìê°€ ë¡œì»¬ì— ë¹Œë“œë„êµ¬ë¥¼ ì§ì ‘ ì„¤ì¹˜í•  í•„ìš”ê°€ ì—†ë‹¤.
- ìµœìƒìœ„ í”„ë¡œì íŠ¸ì—ì„œ í•˜ìœ„í”„ë¡œì íŠ¸ë¥¼ í•œë²ˆì— ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. (**ì†ì‰¬ìš´ ë©€í‹° í”„ë¡œì íŠ¸ ê¸°ëŠ¥ ì œê³µ**)
    - í•˜ìœ„í”„ë¡œì íŠ¸ì˜ build scriptë¥¼ ì¼ì¼íˆ ì—´ì–´ì„œ ë³¼ í•„ìš”ê°€ ì—†ë‹¤. (í”„ë¡œì íŠ¸ ê·œëª¨ê°€ ì»¤ì§ˆìˆ˜ë¡ ì¥ì )
    - Cross project Configuration
- í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë™ì  ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±ì´ ì‰½ë‹¤.
    
    

## Gradle Wrapper?

- ì˜ˆë¥¼ë“¤ì–´ Gradleë¡œ êµ¬ì„±ëœ ì–´ë–¤ í”„ë¡œì íŠ¸ë¥¼ gitìœ¼ë¡œ ë°›ì•„ì„œ ë¹Œë“œí•˜ë ¤ë©´ Gradleì´ í•´ë‹¹ ì‹œìŠ¤í…œì— ì„¤ì¹˜ ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤. í•˜ì§€ë§Œ ì„¤ì¹˜í•˜ë ¤ëŠ” Gradleì˜ ë²„ì „ê³¼ ë‚´ì¥ëœ Gradleì˜ ë²„ì „ì´ ë‹¤ë¥¸ ê²½ìš° í”„ë¡œì íŠ¸ê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ ìƒê¸´ë‹¤. Gradleì€ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ Gradle Wrapperë¥¼ ì œê³µí•œë‹¤.
- Gradle WrapperëŠ” gradlew ë˜ëŠ” gradlew.batìœ¼ë¡œ ì‹¤í–‰í•˜ë©° ë‚´ì¥ Gradleì„ í†µí•´ì„œ ë™ì‘í•œë‹¤.

```bash
// ì¼ë°˜ gradle ì‚¬ìš©
gradle task

// gradlew ì‚¬ìš©
./gradlew task

// gradle wrapper ìƒì„±
gradle wrapper

// íŠ¹ì •ë²„ì „ì˜ gradle wrapper ìƒì„±
gradle wrapper --gradle-version 6.5
```

- ìœ„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ê°™ì€ wrapper íŒŒì¼ì´ ìƒì„±ëœë‹¤.
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-25 á„‹á…©á„’á…® 3.21.54.png](Gradle%20032893aaf159450f856fd843fcb77420/a.png)
    

## Gradle ì„¤ì¹˜ (v7)

- gradle ë²„ì „ì—ë§ëŠ” jdkë¥¼ í™•ì¸ í›„ ì„ í–‰ìœ¼ë¡œ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

[https://gradle.org/install/](https://gradle.org/install/)

- macì—ì„œ ì„¤ì¹˜

```bash
// mac
brew install gradle
```

- window

[https://gradle.org/releases/](https://gradle.org/releases/)

### í™˜ê²½ë³€ìˆ˜ ì„¤ì •

- ê°ê° ìš´ì˜ì²´ì œì— ë§ê²Œ ì„¤ì •

## Gradle í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°

- Gradle í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê±°ë‚˜ gradle init â€”type java-application ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ë‚˜ì˜¤ëŠ” í´ë”êµ¬ì¡°

```
â”œâ”€â”€**build.gradle**
â”œâ”€â”€gradle
â”‚   â””â”€â”€wrapper
â”‚       â”œâ”€â”€gradle-wrapper.jar
â”‚       â””â”€â”€gradle-wrapper.properties
â”œâ”€â”€**gradlew**
â”œâ”€â”€**gradlew.bat**
â”œâ”€â”€**settings.gradle**
â””â”€â”€src
    â”œâ”€â”€main
    â”‚   â””â”€â”€java
    â”‚       â””â”€â”€App.java
    â””â”€â”€test
        â””â”€â”€java
            â””â”€â”€AppTest.java
```

- srcí´ë”êµ¬ì¡°ëŠ” mavenê³¼ ë™ì¼í•˜ë‹¤.

## Gradleì˜ ìŠ¤í¬ë¦½íŠ¸, ì†ì„±íŒŒì¼

- ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ (init.gradle)
    - ì‚¬ìš©ì ì •ë³´, ì‹¤í–‰í™˜ê²½, ì´ˆê¸° ì„¤ì •ê°’ ë“±ì„ ì •ì˜
- **ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ (settings.gradle)**
    - **í”„ë¡œì íŠ¸ ëª…, í”„ë¡œì íŠ¸ êµ¬ì¡° ë“±ì„ ì •ì˜**
- **ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸ (build.gradle)**
    - **ë¹Œë“œ ìˆ˜í–‰ê³¼ ê´€ë ¨ëœ ì˜ì¡´ì„±, task ë“±ì„ ì •ì˜**
- ì†ì„±íŒŒì¼ (gradle.properties)
    - ë¹Œë“œ í™˜ê²½ ì†ì„±ë“±ì„ ì •ì˜

## Gradle ê¸°ë³¸ ì‚¬ìš©ë²•

- í…ŒìŠ¤íŠ¸ í´ë”ì— build.gradle íŒŒì¼ì„ ìƒì„±í•œ í›„ task ì½”ë“œ ì‘ì„±

```groovy
// build.gralde
task gradleTest {
	println "Gradle Test!!"
}

// ì‹¤í–‰
gradle gradleTest
```

## Groovy

- [http://groovy-lang.org](http://groovy-lang.org/)

```groovy
// ìë°”ì™€ ê°™ì´ í˜• ì§€ì •
String id = 'gradle'

// í˜• ì§€ì • ìƒëµ (Groovy í˜• ì§€ì • íŠ¹ì§•)
def id == 'gradle'
println id.toUpperCase()

// ë¬¸ìì—´ ì•ˆì— ë³€ìˆ˜ ì‚¬ìš©
String id = "ID: ${id}" // $idë„ ê°€ëŠ¥

// ë¦¬ìŠ¤íŠ¸
def list = ['groovy', 'java']
println id[1]

// ë§µ
def map = ['a': 'groovy', 'b': 'java']
println id['a']
```

## í”„ë¡œì íŠ¸ ì†ì„± ì§€ì •ë°©ë²•

### properties íŒŒì¼ ì‚¬ìš©í•´ì„œ ì†ì„± ì¶”ê°€

```groovy
// gradle.properties
msg=Gradle Properties Test

// gradle.build
task hello {
	println msg
}
```

### ëª…ë ¹ì–´ ì¸ìˆ˜ë¡œ ì†ì„± ì¶”ê°€

```groovy
task hello {
	println msg
}

// shellë¡œ ì‹¤í–‰
gradle **-Pmsg**='Gradle Properties Test' hello
```

## Gradle & Groovy ì‹¤ìŠµ

### Task ì‹¤ìŠµ

- ë°˜ë³µë¬¸

```groovy
task taskExample {
    10.times { println "$it" }
}

3.times { counter ->
    task "taskExample$counter" {
        println "task counter: $counter"
    }
}

taskExample1.dependsOn taskExample0, taskExample2

// ì‹¤í–‰
gradle taskExample1
0
1
2
```

- doFirst, doLast

```groovy
task task1 {
    doLast {
        println ">>> doLast!"
    }
    doFirst {
        println ">>> doFirst!"
    }
}

// ì‹¤í–‰
gradle -q task1
>>> doFirst!
>>> doLast!
```

- ì¡°ê±´ì— ë”°ë¥¸ ë¹Œë“œ

```groovy
// 1
task exeTask {
    onlyIf {
        buildType == 'partial-build'
    }
    println "Gradle Build Success"
}

// ì´ê²ƒë„ ê°€ëŠ¥
exeTask.onlyIf {
    buildType == 'partial-build'
}

// ì‹¤í–‰
gradle **-PbuildType**='partial-buid' exeTask

// 2
task exeTask {
    println "Build Success"

    if (process == 'error') {
        println "error"
    }

    println "Build End"
}

// ì‹¤í–‰
gradle -Pprocess=error exeTask
Build Success
error
Build End
```

## build.gradle ì‘ì„±í•˜ê¸°

- Gradleì˜ ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ **ì²˜ë¦¬ë¬¸ê³¼ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡**ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.
- ì²˜ë¦¬ë¬¸ (ì§€ì—­ë³€ìˆ˜, ì†ì„± ì„¤ì • ë° ë©”ì†Œë“œ ì‹¤í–‰ ë“± ì¼ë°˜ì ì¸ ì–¸ì–´ì˜ ì²˜ë¦¬ë¬¸ê³¼ ê°™ìŒ)

```groovy
def message = 'Gradle Build'

task hello {
    println "message = ${message}"
}
```

- ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ (íŠ¹ì • ì„¤ì •ì„ ìœ„í•œ ì˜ì—­)

```groovy
buildscript {
	...
}
configurations {
	...
}
repositories {
	...
}
dependencies {
	...
}
subprojects {
	...
}
allprojects {
	...
}
```

### ì£¼ìš” ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡

([https://docs.gradle.org/current/dsl/](https://docs.gradle.org/current/dsl/)) ì°¸ê³ 

- buildscript (gradle ìì²´ ì„¤ì •)
- plugins (plugin ì„¤ì •)
- repositories (ì¤‘ì•™ì €ì¥ì†Œ ì„¤ì •)
- dependencies (ì˜ì¡´ ê´€ê³„ ì„¤ì •)
    - implementation
    - classpath
- configurations (í™˜ê²½ êµ¬ì„±)
- subprojects (ì„œë¸Œ í”„ë¡œì íŠ¸ ì„¤ì •)
- allprojects (ì „ì²´ í”„ë¡œì íŠ¸ ì„¤ì •)

### buildscript, allprojects ì°¨ì´

- buildscript ì„¤ì • ì„¹ì…˜ì€ gradle ìì²´ë¥¼ ìœ„í•œ ì„¹ì…˜ì´ë‹¤. (gradleì´ ë¹Œë“œë¥¼ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ì„¤ì •)
- allprojectsëŠ” Gradleì—ì„œ ë¹Œë“œí•˜ëŠ” ëª¨ë“ˆì„ ìœ„í•œ ì„¹ì…˜ì´ë‹¤.
    - ê° ëª¨ë“ˆì— ëŒ€í•œ ì¢…ì†ì„±ì€ ê³ ìœ í•˜ë©° ê°ê° ëª¨ë“ˆ ë‚´ì˜ build.gradle íŒŒì¼ì— ì¡´ì¬í•˜ì§€ë§Œ ëª¨ë“  ëª¨ë“ˆì—ì„œ ê³µí†µìœ¼ë¡œ ê³µìœ í•˜ëŠ” ì¢…ì†ì„±ì€ allprojectsì— ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
    

### buildscript

- ë¹Œë“œë¥¼ ìœ„í•´ ì‹¤í–‰ë˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ (gradle ìŠ¤í¬ë¦½íŠ¸ ìì²´ ì„¤ì •ì„)
- ë¹Œë“œ ì‹œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ì™€ì•¼í•  ë•Œ ì‚¬ìš©í•˜ë©°, repositoriesì™€ dependenciesë¡œ êµ¬ì„±ëœë‹¤.
- ì‹¬í”Œí•œ í”„ë¡œì íŠ¸ì—ì„œëŠ” í•„ìš”ì—†ìŒ

```groovy
buildscript {
	// ë³€ìˆ˜ ì„¤ì •
	ext {
  	springBootVersion = '1.5.9.RELEASE'
  }
	// buildscript dependenciesì—ì„œ ì˜ì¡´í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì €ì¥ì†Œ ì„¤ì •
  repositories {
  	mavenCentral()
  }
	// 
  dependencies {
      classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
      classpath "io.spring.gradle:dependency-management-plugin:1.0.4.RELEASE"
  }
}
```

### plugins

- Gradle ëª¨ë¸ í™•ì¥, ê·œì¹™ì—ë”°ë¼ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì„±

```groovy
plugins {
	id 'java'
	id 'war'
}

or 

apply plugin: 'war'
apply plugin: 'java'
```

### repositories

- ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê³µê°œì €ì¥ì†Œ ì„¤ì •
- **Maven ì¤‘ì•™ì €ì¥ì†Œ : mavenCentral()**
- Bintray ì €ì¥ì†Œ : jcenter() - maven ë‹¨ì  ë³´ì™„ìœ¼ë¡œ ë§ì´ ì“°ëŠ” ì¶”ì„¸...ì˜€ëŠ”ë° 2ì›”11ì¼ë¶€ë¡œ ì§€ì›ì¢…ë£Œ
- Google ì €ì¥ì†Œ :  google() - android

### dependencies

- repositoriesì—ì„œ ì§€ì •í•œ ì €ì¥ì†Œì—ì„œ ê°€ì ¸ì˜¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë“±ë¡

<aside>
ğŸ’¡ config â€˜ê·¸ë£¹ëª…â€™:â€™ëª¨ë“ˆëª…â€™:â€™versionâ€™
config group: â€˜ê·¸ë£¹ëª…', name: â€˜ëª¨ë“ˆëª…', version: â€˜ë²„ì „â€™

</aside>

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ê´€ê³„ ì •ì˜

```groovy
plugins {
	id 'java'
}

repositories {
	...
}

dependencies {
	implementation "org.springframework.boot:spring-boot-gradle-plugin:2.6.3"
	testImplementation group:'org.springframework.boot', name:'spring-boot-gradle-plugin', version: '2.
	compileOnly ... 
	testCompileOnly... 
	runtimeOnly ... 
	testRuntimeOnly ...
}
```

- ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€í•˜ëŠ” ì„¤ì • (mavenì˜ scope)
    - implementationì„ ì‚¬ìš©í•˜ë©´ í•„ìš”í•œ ëª¨ë“ˆë§Œ ê°€ì ¸ì˜¤ê¸°ë•Œë¬¸ì— ë¹Œë“œì†ë„ê°€ ë¹ ë¥´ë‹¤. (ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©)
    - testCompile, testRuntime, testImplementationì€ ë¹Œë“œê³¼ì •ì—ì„œ ë°°í¬ë³¸ì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤.
    - implementationì€ ì»´íŒŒì¼, ëŸ°íƒ€ì„ ë‘ê°€ì§€ ëª¨ë‘ì— ì‚¬ìš©ëœë‹¤.
    - **í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì–´ë–¤ ë‹¨ê³„ì—ì„œ í•„ìš”í•œì§€ ëª…í™•íˆ êµ¬ë¶„ í›„ ì‚¬ìš©í•´ì•¼ ë¦¬ì†ŒìŠ¤ ë‚­ë¹„ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.**
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-02-27 á„‹á…©á„’á…® 8.30.29.png](Gradle%20032893aaf159450f856fd843fcb77420/í•œê¸€.png)
    

<aside>
ğŸ’¡ compile deprecated.. (v7)

</aside>

- ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì˜ ì˜ì¡´ê´€ê³„ ì„¤ì •

```groovy
// settings.gradle
include 'subProject'

// build.gradle
dependencies {
	implementation project(':subProject')
}

// subProjectê°€ ì—†ì´ buildí•  ê²½ìš°
FAILURE: Build failed with an exception.

* Where:
Build file '/Users/woosanghun/IdeaProjects/Gradle_test2/build.gradle' line: 17

~~~~* What went wrong:
A problem occurred evaluating root project 'Gradle_test2'.
> Project with path ':subProject' could not be found in root project 'Gradle_test2'.
```

- ìµœì‹ ë²„ì „ ì •ì˜

```groovy
dependencies {
	// 1 versionì—ì„œ ìµœì‹ ë²„ì „ ì„¤ì¹˜
	implementation 'org.slf4j:slf4j-api:1.+'
	// ì¶œì‹œ ë²„ì „ ì¤‘ ìµœì‹ ë²„ì „ ì„¤ì¹˜
	implementation 'commons-cli:commons-cli:latest.integration'
	// ë°°í¬ëœ ë²„ì „ ì¤‘ ìµœì‹ ë²„ì „ ì„¤ì¹˜
	implementation 'junit:junit:latestrelease'
}
```

## ë©€í‹° í”„ë¡œì íŠ¸ ê´€ë¦¬ (subprojects, allprojects)

[https://jojoldu.tistory.com/123?category=721560](https://jojoldu.tistory.com/123?category=721560)

- rootProjectì—ì„œ moduleA, moduleB, moduleCommoní”„ë¡œì íŠ¸ë¥¼ í•˜ìœ„ë¡œ ê´€ë¦¬í•˜ê² ë‹¤ëŠ” ì„¤ì •

```groovy
// settings.gradle
rootProject.name='rootProject'
include 'moduleA', 'moduleB', 'moduleCommon'
```

- build.gradle

```groovy
buildscript {
	...
}

// ë£¨íŠ¸ í”„ë¡œì íŠ¸ + ì„œë¸Œ í”„ë¡œì íŠ¸ 
allprojects {

}

**subprojects {
	...
	// settings.gradleì— includeëœ í”„ë¡œì íŠ¸ì—ê´€í•œ ì„¤ì •
	apply plugin: 'java'
  apply plugin: 'org.springframework.boot'
  apply plugin: 'io.spring.dependency-management'

  sourceCompatibility = 1.8

  repositories {
      mavenCentral()
  }

  dependencies {
      testCompile group: 'junit', name: 'junit', version: '4.12'
  }
}

// í•˜ìœ„ í”„ë¡œì íŠ¸ê°„ ì˜ì¡´ì„± ê´€ë¦¬
project(':moduleA') {
	dependencies {
		implementation project(':moduleCommon')
	}
}

project(':moduleB') {
	dependencies {
		implementation project(':moduleCommon')
	}
}**
```

- moduleAì™€ moduleBëŠ” ëª¨ë‘ moduleCommonì— ì˜ì¡´í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ì„¤ì •

## ë¹Œë“œ ëª…ë ¹ì–´ & ì˜µì…˜

```bash
# ì¼ë°˜ ë¹Œë“œ
gradle build

# í…ŒìŠ¤íŠ¸ ì œì™¸í•˜ê³  ë¹Œë“œ
gradle build --exclude-task test

# ë¹Œë“œ ê³¼ì •ì„ í™•ì¸í•˜ê³  ì‹¶ì„ ë•Œ
gradle build --console=verbose

# ë‹¤ìš´ë¡œë“œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ìºì‰¬ë¥¼ ì œê±°í›„ ë‹¤ì‹œ ë¹Œë“œí•œë‹¤.
gradle build --refresh-dependencies

# warë¡œ ë¹Œë“œ
gradle war

# jarë¡œ ë¹Œë“œ
gradle jar
```

- warë¡œ ë¹Œë“œí•  ì‹œì— í•„ìš”í•œ plugin ì¶”ê°€ (ë‘˜ì¤‘ í•˜ë‚˜ë§Œ ì¶”ê°€í•˜ë©´ ë¨)

```groovy
plugins {
	**id 'war'**
}

**apply plugin:'war'**
```

## Gradle ê¸°ë³¸ ì‹¤ìŠµ

<aside>
ğŸ’¡ Intelij
jdk 8
spring boot 2.6.4

</aside>

### (1) Spring project ìƒì„± (+ Gradle)

- gradle ë²„ì „ì— ë§ëŠ” jdk ì„ íƒ
    - gradle(6.7) â‡’ jdk 1.8
- í”„ë¡œì íŠ¸ êµ¬ì¡°
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-03 á„‹á…©á„Œá…¥á†« 10.36.29.png](Gradle%20032893aaf159450f856fd843fcb77420/í•œê¸€_íŠ¹ìˆ˜ë¬¸ì.png)
    
    - **gradle** : wrapper ê´€ë ¨ íŒŒì¼ë“¤
    - **src** : maven êµ¬ì¡°ì™€ ë™ì¼, ì†ŒìŠ¤ì½”ë“œ ë° resource
    - **build.gradle** : gradle build script ì„¤ì •íŒŒì¼
    - **gradlew(.bat):** gradle wrapper ì‹¤í–‰íŒŒì¼ (mac, linux or window)
    - **settings.gradle** : gradle ì„¤ì •íŒŒì¼
    

### (2) build.gradle í…ŒìŠ¤íŠ¸

- dependenciesì— ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ë³´ê³  ì‹¤ì œë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.

```bash
plugins {
    id 'org.springframework.boot' version '2.6.4'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    id 'java'
    id 'war'
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = '1.8'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    providedRuntime 'org.springframework.boot:spring-boot-starter-tomcat'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    **implementation 'org.springframework.boot:spring-boot-starter-data-jpa:2.6.4'
    implementation 'org.projectlombok:lombok:1.18.22'**
}

tasks.named('test') {
    useJUnitPlatform()
}
```

- spring boot starter data jpaì™€ lombok ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•œë‹¤.
- External Librariesì— ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.

### (3) ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°

- Intelijì—ì„œ ê°€ë” refresh OR rebuild projectë¥¼ ì§„í–‰í•´ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì¶”ê°€ ë˜ì§€ ì•Šì•˜ì„ ë•Œ ìˆ˜ë™ìœ¼ë¡œ ë™ê¸°í™” ì‹œí‚¤ëŠ” ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.
- View â†’ Tool Windows â†’ Gradle â†’ Reload Gradle Project í´ë¦­
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-03 á„‹á…©á„Œá…¥á†« 10.58.13.png](Gradle%20032893aaf159450f856fd843fcb77420/í•œê¸€_ìˆ«ì_2022-12.png)
    

### (4) War, Jar ë¹Œë“œ í…ŒìŠ¤íŠ¸

```bash
**1. war ë¹Œë“œ
gradle war

2. jar ë¹Œë“œ
gradle jar

3. gradlew ì‚¬ìš© war ë¹Œë“œ (ë°°í¬ìš© (ì™¸ì¥was))
./gradlew war

4. gradlew ì‚¬ìš© war ë¹Œë“œ (ë‹¨ìˆœ ì‹¤í–‰ìš© (ë‚´ì¥wasì‚¬ìš©))
./gradlew bootWar**

5. lib ë¹„ìš°ê³  ë‹¤ì‹œ ë¹Œë“œ
./gradlew clean bootWar

6. íŠ¹ì • task ë¬´ì‹œ
./gradlew bootWar --exclude-task test

7. ìì„¸í•œì •ë³´ í™•ì¸
./gradlew bootWar --info
```

- warëŠ” ì™¸ì¥ wasì„œë²„ì— ë°°í¬í•  ëª©ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” taskì´ë©°, bootWarëŠ” ë‚´ì¥í†°ìº£ì´ í•¨ê»˜ ë§Œë“¤ì–´ì ¸ ë‹¨ë…ì‹¤í–‰ì´ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ì–´ì£¼ëŠ” taskì´ë‹¤.

- ì„±ê³µí•˜ë©´ build/libs ì•„ë˜ì— í•´ë‹¹ íŒ¨í‚¤ì§•íŒŒì¼ ìƒì„±
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-03 á„‹á…©á„’á…® 1.17.22.png](Gradle%20032893aaf159450f856fd843fcb77420/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-03-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.17.22.png)
    

- war or jaríŒŒì¼ì´ ì¡´ì¬í•˜ëŠ” build ë””ë ‰í„°ë¦¬ê°€ ìƒì„±ë˜ì§€ ì•Šì„ ê²½ìš°
    - Project Structure â†’ Excludedì— buildë‚˜ out ë””ë ‰í„°ë¦¬ê°€ ì¶”ê°€ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„ ì œê±°
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-03 á„‹á…©á„’á…® 1.14.18.png](Gradle%20032893aaf159450f856fd843fcb77420/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-03-03_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.14.18.png)
    

## ë©€í‹° í”„ë¡œì íŠ¸ ì‹¤ìŠµ

### (1) root Project ìƒì„±

- File â†’ New Project â†’ Gradle â†’ Additinal Librariesì— Java ì„ íƒ

### (2) sub Project ìƒì„±

- í•„ìš”í•œë§Œí¼ sub project ìƒì„±
- New â†’ Module â†’ Gradle or Spring Initializr ì„ íƒ í›„ ëª¨ë“ˆ ìƒì„±
- ë°˜ë“œì‹œ root proejctì˜ **module**ë¡œ ìƒì„±ë˜ì–´ì•¼ í•¨
- ì´í´ë¦½ìŠ¤ì˜ ê²½ìš° sub í”„ë¡œì íŠ¸ì˜ ê²½ë¡œê°€  ë£¨íŠ¸ í”„ë¡œì íŠ¸ì˜ Location ì•„ë˜ì— ì§€ì •ë˜ì–´ì•¼ í•¨
    - ex) .../Users/sanghun/git/**gradle-root**/**gradle-admin**

### (3) í”„ë¡œì íŠ¸ êµ¬ì¡° ë° ì •ë¦¬

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-07 á„‹á…©á„’á…® 2.39.07.png](Gradle%20032893aaf159450f856fd843fcb77420/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-03-07_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.39.07.png)

- ìœ„ì™€ê°™ì´ gradle-rootë¼ëŠ” ë£¨íŠ¸ í”„ë¡œì íŠ¸ì•ˆì— ëª¨ë“ˆë¡œ 3ê°œì˜ ì„œë¸Œ í”„ë¡œì íŠ¸ê°€ ë“¤ì–´ê°
- í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— srcí´ë”ëŠ” ì‚­ì œ(ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
- ë£¨íŠ¸í”„ë¡œì íŠ¸ì—ì„œ ëª¨ë“  ì„¤ì •ê³¼ ë¹Œë“œë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ ì„œë¸Œí”„ë¡œì íŠ¸ì˜ gradle í´ë” ë° gradlewê´€ë ¨ íŒŒì¼, settings.gradleíŒŒì¼ì€ í•„ìš”ê°€ ì—†ìœ¼ë©° srcí´ë”(í•„ìš”í•œê²½ìš°)ì™€ build.gradleë§Œ ì¡´ì¬í•˜ë©´ ëœë‹¤.
    - ì• ì´ˆì— í”„ë¡œì íŠ¸ ìƒì„± ì‹œ Gradleë¡œ ìƒì„±í•˜ë©´ ê·€ì°®ìŒì„ ëœ ìˆ˜ ìˆë‹¤..

### (5) root â†”Â sub ê´€ê³„ ì§€ì •

- Gradle í”„ë¡œì íŠ¸ë¡œ ìƒì„±í•œ ëª¨ë“ˆì€ ìë™ìœ¼ë¡œ root í”„ë¡œì íŠ¸ì— include ë˜ì–´ ìˆì§€ë§Œ, Spring Initializrë¡œ ìƒì„±í•œ ëª¨ë“ˆì€ ìˆ˜ë™ìœ¼ë¡œ ë“±ë¡í•´ì£¼ì–´ì•¼ í•œë‹¤.
- settings.gradleì—ì„œ í”„ë¡œì íŠ¸ë¥¼ í¬í•¨ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```groovy
// settings.gradle (root)
rootProject.name = 'gradle-root'
include 'gradle-common'
include 'gradle-service'
include 'gradle-service-default'
include 'gradle-graphql'
// ìˆ˜ë™ ë“±ë¡
**include 'gradle-webserver-admin'**
```

- multi project ê´€ê³„ í™•ì¸

```groovy
**./gradlew -q project**

------------------------------------------------------------
Root project 'gradle-root'
------------------------------------------------------------

Root project 'gradle-root'
+--- Project ':gradle-common'
+--- Project ':gradle-graphql'
+--- Project ':gradle-service'
+--- Project ':gradle-service-default'
\--- Project ':gradle-webserver-admin'
```

### (6) root Project build.gradle ìˆ˜ì •

```groovy
buildscript {
    ext {
        springBootVersion= '2.6.4'
    }

    repositories {
        mavenCentral()
    }

    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath "io.spring.gradle:dependency-management-plugin:1.0.6.RELEASE"
    }
}

allprojects {
    group 'com.gradle'
    version '1.0.0-SNAPSHOT'
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    sourceCompatibility = 1.8

    repositories {
        mavenCentral()
    }

    // ì„œë¸Œ í”„ë¡œì íŠ¸ ê³µí†µ ì˜ì¡´ì„± ì •ì˜
    // spring dependency-managementë¡œ ìë™ ë²„ì „ì„¤ì •
    dependencies {
        implementation 'org.projectlombok:lombok'
    }
}

project(':gradle-common') {
    dependencies {

    }
}

project(':gradle-service-default') {
    dependencies {
        implementation project(':gradle-service')
        implementation project(':gradle-common')
    }
}

project(':gradle-graphql') {
    dependencies {
        implementation project(':gradle-common')
    }
}

project(':gradle-webserver-admin') {
    dependencies {
        implementation project(':gradle-common')
        implementation project(':gradle-service-default')
        implementation project(':gradle-graphql')
    }
}
```

### (7) sub project build.gradle

```groovy
// main class ì¡´ì¬í•˜ì§€ ì•ŠëŠ” sub project
bootJar {
    enabled = false
}

jar {
    enabled = true
}

// main classìˆëŠ” project
dependencies {
	// root projectë¡œ ì˜®ê¹€
}
```

### (8) ë©€í‹°í”„ë¡œì íŠ¸ ì˜ì¡´ì„± í™•ì¸

- ìœ„ì—ì„œ sub projectë“¤ ê°„ì— ì„œë¡œ ì˜ì¡´ ê´€ê³„ë¥¼ ì§€ì •í•œê²ƒì„ ì§ì ‘ í™•ì¸í•˜ê³  ì‹¶ìœ¼ë©´ Gradleíƒ­ì„ í™œìš©í•œë‹¤.
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-03-10 á„‹á…©á„Œá…¥á†« 11.34.34.png](Gradle%20032893aaf159450f856fd843fcb77420/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2022-03-10_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.34.34.png)
    
- ìœ„ì™€ê°™ì´ dependencyì•„ë˜ì— ê´€ê³„ë¥¼ ë§ºì€ í”„ë¡œì íŠ¸(ëª¨ë“ˆ)ë“¤ì´ ì¡´ì¬í•˜ë©´ ì„±ê³µ

### (9) Build í…ŒìŠ¤íŠ¸

```groovy
// build
./gradlew build

// íŠ¹ì •ëª¨ë“ˆ ë¹Œë“œ
./gradlew clean build -p **module-name**
```

<aside>
ğŸ’¡ error: package org.junit.jupiter.api does not exist...

</aside>

- Gradle build ì‹œ Testê´€ë ¨ í•´ì„œ ê³„ì† ì—ëŸ¬ê°€ ë‚œë‹¤ë©´?
    - spring-boot-starter-test ì¶”ê°€ í™•ì¸
    - root project â†’ spring-boot ë²„ì „ í™•ì¸

### (10) ë™ì  ìŠ¤í¬ë¦½íŠ¸

- propertiesë¥¼ í™œìš©í•´ í”„ë¡œê·¸ë˜ë°ë°©ì‹ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

### (11) ì‹¤ì œ ì˜ì¡´ í…ŒìŠ¤íŠ¸..

- common â†’ dto
- service â†’ interface
- service-default â†’ impl (dto + interface)

## Nexus ì—°ë™

### (1) Nexus ë ˆí¬ì§€í† ë¦¬ ì‚¬ìš©í•˜ê¸°

```groovy
repositories {
    maven {
        credentials {
            username=nexusUsername
            password=nexusPassword
        }
        url nexusUrl+"/bandi-maven-repository"
        **allowInsecureProtocol=true**
    }
}

dependencies {
    implementation 'com.bandisnc:bandisnc-common-service-default:1.2.6'
}

```

- ìµœì‹  ê·¸ë˜ë“¤ì—ì„œëŠ” ë³´ì•ˆì„ ìœ„í•´ httpì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ì§€ ì•Šê³  ìˆëŠ”ë° ì´ê²ƒì„ ê°•ì œë¡œ ì‚¬ìš©í•˜ê²Œí•˜ëŠ” ì˜µì…˜ì´ allowInsecureProtocolì´ë‹¤.

### (2) Nexus ë°°í¬

```groovy
subprojects {
	apply plugin: 'maven-publish'

	// Gradle 6ë§Œ ê°€ëŠ¥
    uploadArchives {
        repositories {
            mavenDeployer {
                repository(url: nexusUrl+'/bandi-maven-repository') {
                    authentication(userName: nexusUsername, password: nexusPassword)
                }
                snapshotRepository(url: '/bandi-maven-snapshot') {
                    authentication(userName: nexusUsername, password: nexusPassword)
                }
            }
        }
    }
}

```

- 7ë²„ì „ì€ ë‹¤ë¥¸ë°©ì‹ìœ¼ë¡œ í•´ì•¼ë¨,.. í…ŒìŠ¤íŠ¸ì¤‘ ì—ëŸ¬

- ìµœì¢…ì½”ë“œ

```groovy
buildscript {
    ext {
        springBootVersion='2.6.4'
    }

    repositories {
        mavenCentral()
    }

    dependencies {
        classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
        classpath "io.spring.gradle:dependency-management-plugin:1.0.11.RELEASE"
    }
}

allprojects {
    // root + subproject ì„¤ì •
    group 'com.example.package'
    version '1.0.0-SNAPSHOT'
}

subprojects {
    // subproject ì„¤ì •
    apply plugin: 'java'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    sourceCompatibility=1.8

    repositories {
        // mavenCentral()
        maven {
            credentials {
                username=nexusUsername
                password=nexusPassword
            }
            url nexusUrl+'/bandi-maven-repository'
            allowInsecureProtocol=true
        }
    }

    // ì„œë¸Œí”„ë¡œì íŠ¸ ê³µí†µ ì˜ì¡´ì„± ì •ì˜
    dependencies {
        compileOnly 'org.projectlombok:lombok'
        testImplementation 'junit:junit'
    }

}

project(':gradle-common') {
    dependencies {

    }
}

project('gradle-service') {
    dependencies {
        implementation project(':gradle-common')
    }
}

project('gradle-service-default') {
    dependencies {
        implementation project(':gradle-service')
        implementation project(':gradle-common')
        implementation 'com.bandisnc:bandisnc-license-service-default:1.2.6'
    }
}

if (profile == 'A') {
    project('gradle-webserver-admin') {
        apply plugin:'war'
        dependencies {
            implementation 'org.springframework.boot:spring-boot-starter-web'
            providedRuntime 'org.springframework.boot:spring-boot-starter-tomcat'
            testImplementation 'org.springframework.boot:spring-boot-starter-test'
            implementation project(':gradle-service-default')
        }
    }
} else {
    println('profile other')
    project('gradle-webserver-admin') {
        apply plugin:'war'
        dependencies {
            implementation 'org.springframework.boot:spring-boot-starter-web'
            providedRuntime 'org.springframework.boot:spring-boot-starter-tomcat'
            testImplementation 'org.springframework.boot:spring-boot-starter-test'
            implementation project(':gradle-service-default')
            implementation project(':gradle-common')
        }
    }
}
```
